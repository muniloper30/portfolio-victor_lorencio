<section id="skills" class="py-24 relative overflow-hidden">
    <div class="container mx-auto px-4 max-w-7xl">
        <div class="text-center mb-16">
            <div class="flex justify-center items-center gap-4 mb-9">
                <span class="text-2xl md:text-3xl font-bold font-mono text-accent">04.</span>
                <h2
                    class="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">
                    Skills
                </h2>
            </div>
            <p class="text-slate-400 text-sm md:text-base max-w-2xl mx-auto italic">
                Haz clic en cada una de las tarjetas de abajo para obtener más información sobre mi experiencia con
                estas tecnologías.
            </p>
        </div>

        <!-- Column Layout Wrapper -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 md:gap-8">

            @for (column of columns; track $index) {
            <div class="flex flex-col gap-6 md:gap-8">
                @for (item of column; track $index) {

                @if (isSkill(item)) {
                <!-- Single Item (Large or Small rendered as block) -->
                <ng-container *ngTemplateOutlet="skillCard; context: { $implicit: item }"></ng-container>
                } @else {
                <!-- Row of Items -->
                <div class="grid grid-cols-2 gap-6 md:gap-8">
                    @for (subItem of item; track subItem.name) {
                    <ng-container *ngTemplateOutlet="skillCard; context: { $implicit: subItem }"></ng-container>
                    }
                </div>
                }

                }
            </div>
            }

        </div>
    </div>
</section>

<!-- Reusable Skill Card Template -->
<ng-template #skillCard let-skill>
    <!-- Outer Wrapper: Handles Layout, Size, Scale, and Pop-out Icon context -->
    <div class="group relative transition-all duration-300 hover:scale-[1.02] cursor-pointer flex flex-col"
        (click)="openModal(skill)" [class.min-h-[360px]]="skill.size === 'large'"
        [class.min-h-[140px]]="skill.size === 'small'">

        <!-- Icon: Absolute positioned on Outer Wrapper to allow pop-out (overflow-visible implied by default on div) -->
        <div
            class="absolute -top-4 -left-1 md:-top-5 md:-left-1 w-10 h-10 md:w-12 md:h-12 transition-transform duration-300 group-hover:scale-110 z-30 pointer-events-none">
            @if (skill.icon) {
            <img [src]="skill.icon" [alt]="skill.name" class="w-full h-full object-contain drop-shadow-lg" />
            }
        </div>

        <!-- Inner Card: Handles Background, Clipping, Border, Shadow, Content -->
        <!-- overflow-hidden ensures the full-width skewed background is clipped by rounded corners -->
        <div class="relative flex-grow flex flex-col justify-between rounded-3xl p-6 overflow-hidden bg-gradient-to-br from-slate-800/80 via-slate-900/80 to-zinc-900/80 backdrop-blur-md"
            [style.box-shadow]="'0 -4px 20px -5px ' + skill.color + '40, -4px -4px 20px -5px ' + skill.color + '40, 4px -4px 20px -5px ' + skill.color + '40'"
            [style.--skill-color]="skill.color">

            <!-- Fading Neon Border (Top, Left, Right) -->
            <div class="absolute inset-0 rounded-3xl pointer-events-none z-20"
                style="border: 1px solid var(--skill-color); mask-image: linear-gradient(to bottom, black 40%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);">
            </div>

            <!-- Glow Effect on Hover -->
            <div class="absolute -inset-px rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 z-0"
                [style.background]="'radial-gradient(600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), ' + skill.color + '20, transparent 40%)'">
            </div>

            <!-- Content Header -->
            <div class="flex justify-end items-start w-full relative z-20 mt-2">
                <span
                    class="text-slate-200 font-bold tracking-wide group-hover:text-[var(--skill-color)] transition-colors text-right leading-none"
                    [class.text-2xl]="skill.size === 'large'" [class.md:text-3xl]="skill.size === 'large'"
                    [class.text-xs]="skill.size === 'small'" [class.md:text-sm]="skill.size === 'small'">
                    {{ skill.name }}
                </span>
            </div>

            @if (skill.size === 'large') {
            <div class="mt-8 flex-grow relative z-10 flex items-center">
                <!-- Asymmetrical Rising Background Wrapper (Full Width) -->
                <!-- -mx-6 counters parent padding, px-6 restores text padding -->
                <div
                    class="relative w-[calc(100%+3rem)] -mx-6 py-4 -skew-y-3 bg-white/5 border-y border-white/5 shadow-inner">
                    <!-- Un-skew text content -->
                    <p
                        class="skew-y-3 px-6 text-slate-300 text-sm leading-relaxed line-clamp-4 group-hover:text-white transition-colors">
                        {{ skill.description }}
                    </p>
                </div>
            </div>
            }

            <!-- Stats Footer -->
            <div
                class="mt-auto pt-4 border-t border-white/5 flex justify-between items-center text-xs text-slate-500 font-mono relative z-20">
                <div class="flex flex-col">
                    <span class="uppercase tracking-wider opacity-60 text-[10px]">Exp.</span>
                    <span class="font-bold text-slate-300">{{ skill.years }}</span>
                </div>

                <div class="flex flex-col text-right">
                    <span class="uppercase tracking-wider opacity-60 text-[10px]">Usg.</span>
                    <span class="font-bold text-slate-300">
                        {{ skill.usage }}
                    </span>
                </div>

                @if (skill.size === 'large') {
                <div class="flex flex-col text-right">
                    <span class="uppercase tracking-wider opacity-60 text-[10px] mb-1">En estudio</span>
                    <span class="font-bold text-slate-300">
                        {{ skill.inStudy }}
                    </span>
                </div>
                }
            </div>
        </div>

    </div> <!-- End Outer Wrapper -->
</ng-template>

<app-skill-modal [skill]="selectedSkill()" [isOpen]="!!selectedSkill()" (close)="closeModal()">
</app-skill-modal>